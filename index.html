<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Infinite Innovators - Login</title>
<style>
/* ===== Global Styles ===== */
body {
  margin: 0;
  padding: 0;
  font-family: "Poppins", sans-serif;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start; /* stick to top */
  padding-top: 50px; /* distance from top */
  background: linear-gradient(135deg, #1d6166, #0f2027);
  overflow-x: hidden;
}

/* Container & Card */
.container {
  width: 350px;
  max-width: 95%;
  perspective: 1000px;
}
.card {
  width: 100%;
  transform-style: preserve-3d;
  transition: transform 0.8s;
  position: relative;
}

/* Flip */
.card.flip { transform: rotateY(180deg); }

/* Form Box - Front/Back stacked exactly */
.form-box {
  width: 100%;
  background: #fff;
  border-radius: 20px;
  padding: 25px 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  backface-visibility: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
  position: absolute; /* stack front/back */
  top: 0; left: 0;
}

/* Front & Back */
.front { z-index: 2; }
.back { transform: rotateY(180deg); }

/* Logo */
.logo {
  width: 80px;
  height: auto;
  margin-bottom: 15px;
}

/* Headings */
.form-box h2 {
  text-align: center;
  margin-bottom: 15px;
  color: #1d6166;
  font-size: 1.5em;
}

/* Inputs */
.form-box input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: none;
  border-bottom: 2px solid #ccc;
  outline: none;
  font-size: 14px;
  transition: 0.3s;
}
.form-box input:focus { border-color: #1d6166; }

/* Buttons */
.form-box button {
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  border: none;
  background: #1d6166;
  color: white;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}
.form-box button:hover { background: #138181; }

/* Reset-style button (below login) */
.form-box .reset-btn {
  margin-top: 10px;
  padding: 10px;
  width: 100%;
  border-radius: 8px;
  border: 1px dashed #cfcfcf;
  background: transparent;
  color: #1d6166;
  cursor: pointer;
  font-weight: 600;
}
.form-box .reset-btn:hover { background: rgba(29,97,102,0.06); }

/* Toggle Links */
.toggle-link {
  margin-top: 12px;
  display: block;
  text-align: center;
  font-size: 14px;
  color: #333;
  cursor: pointer;
  text-decoration: underline;
}

/* Messages */
#signup-msg, #login-msg {
  margin-top: 10px;
  font-size: 14px;
  text-align: center;
  word-wrap: break-word;
}

/* Verification Popup */
#verifyPopup, #resetPopup {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(5px);
  display: none;
  justify-content: center;
  align-items: center;
  padding: 10px;
  box-sizing: border-box;
}
.popup-box {
  background: #fff;
  padding: 20px;
  border-radius: 15px;
  text-align: center;
  width: 100%;
  max-width: 360px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.popup-box h3 {
  color: #1d6166;
  margin-bottom: 15px;
  font-size: 1.2em;
}
.popup-box button {
  margin-top: 15px;
  padding: 10px 20px;
  border: none;
  background: #1d6166;
  color: #fff;
  border-radius: 8px;
  cursor: pointer;
}

/* ===== Responsive ===== */
@media screen and (max-width: 1024px) {
  .container { width: 300px; }
  .form-box { padding: 20px; }
  .form-box h2 { font-size: 1.4em; }
  .form-box input, .form-box button { font-size: 14px; padding: 10px; }
  .logo { width: 70px; }
}
@media screen and (max-width: 600px) {
  body { padding-top: 30px; }
  .container { width: 90%; }
  .form-box { padding: 15px; }
  .form-box h2 { font-size: 1.3em; }
  .form-box input, .form-box button { font-size: 13px; padding: 8px; }
  .logo { width: 60px; }
}
</style>
</head>
<body>

<div class="container">
  <div class="card" id="card">
    <!-- Sign Up -->
    <div class="form-box front">
      <img src="logo.png" alt="Logo" class="logo">
      <h2>Sign Up</h2>
      <input type="text" id="signup-name" placeholder="Full Name">
      <input type="email" id="signup-email" placeholder="Email">
      <input type="password" id="signup-password" placeholder="New Password">
      <input type="password" id="signup-confirm" placeholder="Confirm Password">
      <button onclick="signUp()">Register</button>
      <span class="toggle-link" onclick="flipCard()">Already have an account? Sign In</span>
      <div id="signup-msg"></div>
    </div>

    <!-- Sign In -->
    <div class="form-box back">
      <img src="logo.png" alt="Logo" class="logo">
      <h2>Sign In</h2>
      <input type="email" id="login-email" placeholder="Email">
      <input type="password" id="login-password" placeholder="Password">
      <button onclick="signIn()">Login</button>
      <button class="reset-btn" onclick="resetPassword()">Reset Password</button>
      <span class="toggle-link" onclick="flipCard()">Don’t have an account? Sign Up</span>
      <div id="login-msg"></div>
    </div>
  </div>
</div>

<!-- Verification Popup -->
<div id="verifyPopup">
  <div class="popup-box">
    <h3>Verify Your Email</h3>
    <p>We’ve sent a verification link to your email. Please check your inbox and click the link to activate your account.</p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<!-- Reset-confirmation Popup -->
<div id="resetPopup">
  <div class="popup-box">
    <h3>Check your email</h3>
    <p>A password reset link has been sent to <strong id="reset-email"></strong>. Follow the link to reset your password.</p>
    <button onclick="closeResetPopup()">OK</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendEmailVerification,
  sendPasswordResetEmail,
  signOut,
  updateProfile
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzzNaUWyBn_z7A5Rjt_ooR3yEfA44heJA",
  authDomain: "laserqr-fd4fa.firebaseapp.com",
  databaseURL: "https://laserqr-fd4fa-default-rtdb.firebaseio.com",
  projectId: "laserqr-fd4fa",
  storageBucket: "laserqr-fd4fa.firebasestorage.app",
  messagingSenderId: "191584527271",
  appId: "1:191584527271:web:71dad945fa1b18c0024c82",
  measurementId: "G-88ZMKEZT24"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Flip Card
window.flipCard = function() {
  document.getElementById("card").classList.toggle("flip");
}

// Sign Up
window.signUp = function() {
  const name = document.getElementById("signup-name").value.trim();
  const email = document.getElementById("signup-email").value.trim();
  const password = document.getElementById("signup-password").value;
  const confirm = document.getElementById("signup-confirm").value;
  const msg = document.getElementById("signup-msg");

  if(!name || !email || !password || !confirm){ 
    msg.style.color="red"; msg.textContent="Fill all fields!"; return; 
  }
  if(password.length < 6){ 
    msg.style.color="red"; msg.textContent="Password must be 6+ chars"; return; 
  }
  if(password !== confirm){ 
    msg.style.color="red"; msg.textContent="Passwords do not match!"; return; 
  }

  createUserWithEmailAndPassword(auth, email, password)
    .then(async (userCredential) => {
      await updateProfile(userCredential.user, { displayName: name });
      await sendEmailVerification(userCredential.user);

      msg.style.color="green"; 
      msg.textContent="Registered! Verify email.";
      document.getElementById("verifyPopup").style.display="flex";
      signOut(auth);
    })
    .catch(error => {
      msg.style.color="red";
      switch(error.code){
        case "auth/email-already-in-use": msg.textContent="Email exists. Try login!"; break;
        case "auth/invalid-email": msg.textContent="Invalid email!"; break;
        default: msg.textContent="Error. Contact dev!"; break;
      }
      console.error(error);
    });
}

// Sign In
window.signIn = function() {
  const email = document.getElementById("login-email").value.trim();
  const password = document.getElementById("login-password").value;
  const msg = document.getElementById("login-msg");

  if(!email || !password){ 
    msg.style.color="red"; msg.textContent="Fill all fields!"; return; 
  }

  signInWithEmailAndPassword(auth, email, password)
    .then(userCredential => {
      if(!userCredential.user.emailVerified){ 
        msg.style.color="red"; msg.textContent="Verify your email first!"; 
        signOut(auth); 
        return; 
      }
      msg.style.color="green"; 
      msg.textContent="Login successful!";
      setTimeout(()=>{ window.location.href="home.html"; }, 1000);
    })
    .catch(error => {
      msg.style.color="red";
      switch(error.code){
        case "auth/user-not-found": msg.textContent="Email not found! Signup first."; break;
        case "auth/wrong-password": msg.textContent="Incorrect password!"; break;
        case "auth/invalid-email": msg.textContent="Invalid email format!"; break;
        default: msg.textContent="Incorrect password or invalid Email!"; break;
      }
      console.error(error);
    });
}

// Reset Password
window.resetPassword = function(){
  const email = document.getElementById("login-email").value.trim();
  const msg = document.getElementById("login-msg");

  if(!email){ 
    msg.style.color="red"; msg.textContent="Enter your email to receive reset link."; return; 
  }

  sendPasswordResetEmail(auth, email)
    .then(() => {
      document.getElementById("reset-email").textContent = email;
      document.getElementById("resetPopup").style.display = "flex";
      msg.textContent = "";
    })
    .catch(error => {
      msg.style.color="red";
      switch(error.code){
        case "auth/user-not-found": msg.textContent="No account with this email."; break;
        case "auth/invalid-email": msg.textContent="Invalid email format!"; break;
        default: msg.textContent="Could not send reset link. Try again later."; break;
      }
      console.error(error);
    });
}

// Close Popup (verify)
window.closePopup = function(){
  document.getElementById("verifyPopup").style.display="none";
  document.getElementById("card").classList.add("flip"); 
  const msg = document.getElementById("login-msg");
  msg.style.color = "green"; msg.textContent = "Verify email then login!";
}

// Close Reset Popup
window.closeResetPopup = function(){
  document.getElementById("resetPopup").style.display = "none";
  const msg = document.getElementById("login-msg");
  msg.style.color = "green";
  msg.textContent = "Reset email sent — check your inbox.";
}
</script>
</body>
</html>
